version: '3.8'

services:
    collector:
        build:
            context: collector
            dockerfile: Dockerfile
        volumes:
            - ./collector/autodba-collector.conf:/usr/local/autodba/share/collector/collector.conf:ro
        depends_on:
            - collector-api

    collector-api:
        build:
            context: collector-api
            dockerfile: Dockerfile
        ports:
            - "${COLLECTOR_API_PORT:-7080}:7080"
        volumes:
            - collector_api_storage:/usr/local/autodba/share/collector_api_server/storage
        depends_on:
            - prometheus

    bff-webapp:
        build:
            context: bff
            dockerfile: Dockerfile
        ports:
            - "${BFF_WEBAPP_PORT:-4000}:4000"
        depends_on:
            - prometheus

    prometheus:
        build:
            context: prometheus
            dockerfile: Dockerfile
        ports:
            - "${PROMETHEUS_PORT:-9090}:9090"
        volumes:
            - prometheus_data:/usr/local/autodba/prometheus_data

volumes:
    prometheus_data:
    collector_api_storage:
