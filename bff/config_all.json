{
    "port": "4000",
    "prometheus_server": "http://localhost:7001",
    "routes_config": {
        "/v1/allMetrics": {
            "params": ["database_id","start","end"],
            "options" : {
                "start": "$start",
                "end": "$end"
            },
            "metrics": {
                "connections": "sum(pg_stat_database_numbackends{database_id=~\"$database_id\"})",
                "connections_percent": "sum(pg_stat_database_numbackends{database_id=~\"$database_id\"})/sum(pg_settings_max_connections)",
                "cpu": "sum(rds_cpu_usage_percent_average{dbidentifier=~\"$database_id\"})",
                "commits": "rate(pg_stat_database_xact_commit{database_id=~\"$database_id\"}[1m])",
                "disk_usage": "1-(sum(rds_free_storage_bytes{dbidentifier=\"$database_id\"})/sum(rds_allocated_storage_bytes{dbidentifier=\"$database_id\"}))",
                "disk_available": "sum(rds_free_storage_bytes{dbidentifier=\"$database_id\"})",
                "io": "sum by(crystal_metric) (rate(crystal_pg_stat_io_overview{crystal_metric=~\"$crystal_pg_stat_io_metric\"}[1m]))",
                "io_activity": "avg by(crystal_metric) (rate(crystal_pg_stat_io_activity_overview{crystal_metric!~\"pid\", crystal_metric=~\"$crystal_pg_stat_io_activity_metric\"}[1m]))",
                "iops_percentage": "(sum(rds_read_iops_average{dbidentifier=~\"$database_id\"})+sum(rds_write_iops_average{dbidentifier=~\"$database_id\"}))/sum(rds_allocated_disk_iops_average{dbidentifier=~\"$database_id\"})",
                "iops": "(sum(rds_read_iops_average{dbidentifier=~\"$database_id\"})+sum(rds_write_iops_average{dbidentifier=~\"$database_id\"}))",
                "rollbacks": "rate(pg_stat_database_xact_rollback{database_id=~\"$database_id\"}[1m])",
                "contention_percent": "sum(crystal_pg_lock_contention{database=~\"$database_id\"})/sum(pg_stat_database_numbackends{database_id=~\"$database_id\"})",
                "contention": "sum(crystal_pg_lock_contention{database=~\"$database_id\"})",
                "buffer_cache_hits_percent": "sum(rate(pg_stat_database_blks_hit{database_id=~\"$database_id\"}[1m])) / (sum(rate(pg_stat_database_blks_hit{database_id=~\"$database_id\"}[1m])) + sum(rate(pg_stat_database_blks_read{database_id=~\"$database_id\"}[1m])))",
                "top_queries": "1-(sum(rds_free_storage_bytes{dbidentifier=\"$database_id\"})/sum(rds_allocated_storage_bytes{dbidentifier=\"$database_id\"}))",
                "":"sum(pg_stat_database_numbackends{datname=~"$datname"})/sum(pg_settings_max_connections)",
                "":"sum(crystal_pg_lock_contention{database=~"$datname"})/sum(pg_stat_database_numbackends{datname=~"$datname"})",
                "":"sum(rds_cpu_usage_percent_average{dbidentifier=~"$dbidentifier"})",
                "":"(sum(rds_read_iops_average{dbidentifier=~"$dbidentifier"})+sum(rds_write_iops_average{dbidentifier=~"$dbidentifier"}))/sum(rds_allocated_disk_iops_average{dbidentifier=~"$dbidentifier"})",
                "":"1-(sum(rds_free_storage_bytes{dbidentifier="$dbidentifier"})/sum(rds_allocated_storage_bytes{dbidentifier="$dbidentifier"}))",
                "":"sum(pg_stat_database_numbackends{datname=~"$datname"})",
                "":"sum(crystal_pg_lock_contention{database=~"$datname"})",
                "":"sum(rds_cpu_usage_percent_average{dbidentifier=~"$dbidentifier"})",
                "":"(sum(rds_read_iops_average{dbidentifier=~"$dbidentifier"})+sum(rds_write_iops_average{dbidentifier=~"$dbidentifier"}))",
                "":"sum(rds_free_storage_bytes{dbidentifier="$dbidentifier"})",
                "":"sort(count(label_replace(label_join(crystal_pg_stat_activity{datname=~"$datname"}, "wait_event_name", ":", "wait_event_type", "wait_event"), "wait_event_name", "CPU", "wait_event_name", ":")) by (wait_event_name))",
                "":"count(label_replace(crystal_pg_stat_activity{datname=~"$datname"}, "application_name", "/*pg internal*/", "application_name", "")) by (application_name)",
                "":"count(label_replace(crystal_pg_stat_activity{datname=~"$datname"}, "datname", "/*pg internal*/", "datname", "")) by (datname)",
                "":"count(label_replace(crystal_pg_stat_activity{datname=~"$datname"}, "client_addr", "/*pg internal*/", "client_addr", "")) by (client_addr)",
                "":"count(crystal_pg_stat_activity{datname=~"$datname"}) by (backend_type)",
                "":"count(label_replace(crystal_pg_stat_activity{query=~"^.*", datname=~"$datname"}, "query", "/* system query */", "query", "")) by (query)",
                "":"count(label_replace(crystal_pg_stat_activity{datname=~"$datname"}, "usename", "/*pg internal*/", "usename", "")) by (usename)",
                "":"sort_desc(avg_over_time(count(label_replace(label_join(crystal_pg_stat_activity{datname=~"$datname"}, "wait_event_name", ":", "wait_event_type", "wait_event"), "wait_event_name", "CPU", "wait_event_name", ":")) by (wait_event_name)[$__range:]))",
                "":"sort_desc(avg_over_time(count(label_replace(crystal_pg_stat_activity{query=~"^.*", datname=~"$datname"}, "query", "/* system query */", "query", "")) by (query)[$__range:]))",
                "":"sort_desc(avg_over_time(count(label_replace(crystal_pg_stat_activity{datname=~"$datname"}, "client_addr", "/*pg internal*/", "client_addr", "")) by (client_addr)[$__range:]))",
                "":"sort_desc(avg_over_time(count(label_replace(crystal_pg_stat_activity{datname=~"$datname"}, "usename", "/*pg internal*/", "usename", "")) by (usename)[$__range:]))",
                "":"sort_desc(avg_over_time(count(crystal_pg_stat_activity{datname=~"$datname"}) by (backend_type)[$__range:]))",
                "":"sort_desc(avg_over_time(count(label_replace(crystal_pg_stat_activity{datname=~"$datname"}, "application_name", "/*pg internal*/", "application_name", "")) by (application_name)[$__range:]))",
                "":"sort_desc(avg_over_time(count(label_replace(crystal_pg_stat_activity{datname=~"$datname"}, "datname", "/*pg internal*/", "datname", "")) by (datname)[$__range:]))",
                "":"count(crystal_pg_stat_activity{datname=~"$datname"}) by (state)",
                "":"sum(pg_stat_database_numbackends{datname=~"$datname"})",
                "":"count(crystal_pg_stat_activity{datname=~"$datname",state="active", wait_event=""})",
                "":"count(crystal_pg_stat_activity{datname=~"$datname",state="active", wait_event=~".+"})",
                "":"sum(rate(crystal_pg_stat_database{crystal_metric="tup_inserted"}[1m]))",
                "":"sum(rate(crystal_pg_stat_database{crystal_metric="tup_updated"}[1m]))",
                "":"sum(rate(crystal_pg_stat_database{crystal_metric="tup_deleted"}[1m]))",
                "":"sum(rate(crystal_pg_stat_database{crystal_metric="tup_returned"}[1m]))",
                "":"sum(rate(crystal_pg_stat_database{crystal_metric="tup_fetched"}[1m]))",
                "":"sum(rate(pg_stat_database_xact_commit{datname=~"$datname"}[1m]))",
                "":"sum(rate(pg_stat_database_xact_rollback{datname=~"$datname"}[1m]))",
                "":"max(rate(crystal_pg_stat_database{crystal_metric="idle_in_transaction_time", datname=~"${datname}"}[1m]))/1000",
                "":"sum(rate(crystal_pg_stat_database{crystal_metric="deadlocks", datname=~"${datname}"}[1m]))",
                "":"max(crystal_max_transaction_age{datname=~"${datname}"})",
                "":"sum(rate(crystal_pg_stat_database{crystal_metric="blks_read"}[1m]))",
                "":"sum(rate(crystal_pg_stat_database{crystal_metric="blks_hit"}[1m]))",
                "":"sum(rds_cpu_usage_percent_average{dbidentifier=~"$dbidentifier"})",
                "":"sum(rds_instance_memory_bytes) - sum(rds_freeable_memory_bytes)",
                "":"sum(rds_freeable_memory_bytes) - sum(pg_settings_shared_memory_size_bytes)",
                "":"sum(pg_settings_shared_memory_size_bytes)",
                "":"sum(rds_read_iops_average{dbidentifier=~"$dbidentifier"})",
                "":"sum(rds_write_iops_average{dbidentifier=~"$dbidentifier"})",
                "":"sum(rds_instance_max_iops_average)",
                "":"sum(rds_read_throughput_bytes{dbidentifier=~"$dbidentifier"})",
                "":"sum(rds_write_throughput_bytes{dbidentifier=~"$dbidentifier"})",
                "":"sum(rds_freeable_memory_bytes{dbidentifier=~"$dbidentifier"})",
                "":"sum(rds_free_storage_bytes{dbidentifier=~"$dbidentifier"})",
                "":"count(crystal_pg_stat_activity{state=~"^idle.*", datname=~"$datname"})",
                "":"count(crystal_pg_stat_activity{state="active", wait_event_type="", datname=~"$datname"})",
                "":"count(crystal_pg_stat_activity{state="active", wait_event_type=~"^.+", datname=~"$datname"})",
                "":"topk(20, sum(increase(crystal_pg_stat_statements{query=~"^.*", crystal_metric="total_exec_time", datname=~"$datname"}[$__range])) by (queryid, query)/(1+sum(increase(crystal_pg_stat_statements{query=~"^.*", crystal_metric="calls", datname=~"$datname"}[$__range])) by (queryid, query)))",
                "":"sum(rate(crystal_pg_stat_statements{query=~"^(create|alter|drop).*", crystal_metric="calls", datname=~"$datname"}[1m]))",
                "":"sum(rate(crystal_pg_stat_statements{query=~"^(insert|update|delete).*", crystal_metric="calls", datname=~"$datname"}[1m]))",
                "":"sum(rate(crystal_pg_stat_statements{query=~"^select.*", crystal_metric="calls", datname=~"$datname"}[1m]))",
                "":"sum(rate(crystal_pg_stat_statements{query=~"^copy.*", crystal_metric="calls", datname=~"$datname"}[1m]))",
                "":"topk(20, (sum(increase(crystal_pg_stat_statements{query=~"^.*", crystal_metric="total_exec_time", datname=~"$datname"}[$__range])) by (queryid, query)/(1+sum(increase(crystal_pg_stat_statements{query=~"^.*", crystal_metric="calls", datname=~"$datname"}[$__range])) by (queryid, query))) / sum(increase(crystal_pg_stat_statements{query=~"^.*", crystal_metric="total_exec_time", datname=~"$datname"}[$__range] offset $__range)) by (queryid, query)/(1+sum(increase(crystal_pg_stat_statements{query=~"^.*", crystal_metric="calls", datname=~"$datname"}[$__range] offset $__range)) by (queryid, query))) * 100 >= 0.01",
            }
        }
    }
}
