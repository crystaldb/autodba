{
  "port": "4000",
  "prometheus_server": "http://localhost:9090",
  "routes_config": {
    "/v1/health": {
      "params": [
        "dbidentifier",
        "datname",
        "start",
        "end",
        "step"
      ],
      "options": {
        "start": "$start",
        "end": "$end",
        "step": "$step"
      },
      "metrics": {
        "connections_percent": "sum(cc_backend_count{database=~\"$datname\"})/sum(pg_settings_max_connections)",
        "cpu": "sum(rds_cpu_usage_percent_average{dbidentifier=~\"$dbidentifier\"})",
        "disk_usage": "1-(sum(rds_free_storage_bytes{dbidentifier=\"$dbidentifier\"})/sum(rds_allocated_storage_bytes{dbidentifier=\"$dbidentifier\"}))"
      }
    },
    "/v1/metric": {
      "params": [
        "dbidentifier",
        "datname",
        "start",
        "end",
        "step"
      ],
      "options": {
        "start": "$start",
        "end": "$end",
        "step": "$step"
      },
      "metrics": {
        "sessions": "count(cc_pg_stat_activity{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}) by (state)",
        "connection_utilization": "sum(cc_backend_count{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"})",
        "transactions_in_progress_active_transactions": "count(cc_pg_stat_activity{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\",state=\"active\", wait_event=\"\"})",
        "transactions_in_progress_blocked_transactions": "count(cc_pg_stat_activity{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\",state=\"active\", wait_event=~\".+\"})",
        "tuples_dml_inserted": "sum(rate(cc_relation_n_tup_ins{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}[65m]))",
        "tuples_dml_updated": "sum(rate(cc_relation_n_tup_upd{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}[65m]))",
        "tuples_dml_deleted": "sum(rate(cc_relation_n_tup_del{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}[65m]))",
        "tuples_reads_returned": "sum(rate(cc_relation_seq_tup_read{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}[65m]))",
        "tuples_reads_returned_fetched": "sum(rate(cc_relation_idx_tup_fetch{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}[65m]))",
        "io_vs_disk_blocks_read": "sum(rate(cc_relation_heap_blks_read{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}[65m]))",
        "io_vs_disk_blocks_hit": "sum(rate(cc_relation_heap_blks_hit{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}[65m]))",
        "transactions_commit": "sum(rate(cc_db_xact_commit{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}[65m]))",
        "transactions_rollback": "sum(rate(cc_db_xact_rollback{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}[65m]))",
        "vacuum_max_used_transaction_ids": "max(cc_db_frozen_xid_age{datname=~\"$datname\",sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"})",
        "cpu_utilization": "sum(cc_system_cpu_user_percent{sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"})",
        "free_memory": "sum(cc_system_memory_free_bytes{sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}) + sum(cc_system_memory_cached_bytes{sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}) + sum(cc_system_memory_buffers_bytes{sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"})",
        "memory_usage_unused_instance_memory": "sum(cc_system_memory_total_bytes{sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}) - (sum(cc_system_memory_free_bytes{sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}) + sum(cc_system_memory_cached_bytes{sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}) + sum(cc_system_memory_buffers_bytes{sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}))",
        "memory_usage_other_freeable_memory": "(sum(cc_system_memory_free_bytes{sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}) + sum(cc_system_memory_cached_bytes{sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"}) + sum(cc_system_memory_buffers_bytes{sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"})) - sum(pg_settings_shared_memory_size_bytes{sys_id=~\"$sys_id\",sys_scope=~\"$sys_scope\",sys_type=~\"$sys_type\"})",
        "memory_usage_shared_memory": "sum(pg_settings_shared_memory_size_bytes{dbidentifier=~\"$dbidentifier\"})",
        "ebs_read_iops": "sum(rds_read_iops_average{dbidentifier=~\"$dbidentifier\"})",
        "ebs_write_iops": "sum(rds_write_iops_average{dbidentifier=~\"$dbidentifier\"})",
        "ebs_current_provisioned_iops": "sum(rds_instance_max_iops_average)",
        "io_read_throughput": "sum(rds_read_throughput_bytes{dbidentifier=~\"$dbidentifier\"})",
        "io_write_throughput": "sum(rds_write_throughput_bytes{dbidentifier=~\"$dbidentifier\"})",
        "free_storage_space": "sum(rds_free_storage_bytes{dbidentifier=~\"$dbidentifier\"})"
      }
    }
  }
}
